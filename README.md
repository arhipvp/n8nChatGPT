# n8n ChatGPT MCP Bridge

## Назначение
Проект запускает локальный MCP-сервер на базе [`fastmcp`](https://github.com/entrez/fastmcp) и пробрасывает его наружу через `ngrok`, чтобы подключить кастомный коннектор в ChatGPT. Основная логика описана в [`main.py`](main.py).

## Зависимости
Для работы требуется Python 3.10+ и следующие пакеты (см. запуск MCP-сервера в `main.py`):
- `fastmcp`
- `httpx`
- `Pillow`
- Anki с установленным плагином [AnkiConnect](https://foosoft.net/projects/anki-connect/) и запущенным Anki-клиентом

## Требования к ngrok
Скрипт ищет исполняемый файл ngrok локально либо в `PATH`, затем поднимает HTTP-туннель и извлекает публичный URL через локальный API `http://127.0.0.1:4040`. Эти шаги реализованы в функциях `find_ngrok_exe`, `ngrok_api_alive` и `get_ngrok_url` в `main.py`. Убедитесь, что:
- ngrok установлен и авторизован токеном;
- доступен через `ngrok.exe`/`ngrok` рядом с проектом или в `PATH`;
- свободна сессия для запуска HTTP-туннеля на порт 8000.

## Пошаговый сценарий
1. **Подготовка окружения**
   - Установите зависимости: `pip install fastmcp httpx Pillow`.
   - Убедитесь, что Anki запущен, а расширение AnkiConnect активно.
   - Поместите `ngrok` рядом с проектом или добавьте в `PATH`, авторизуйте токен: `ngrok config add-authtoken <TOKEN>`.
2. **Запуск**
   - Выполните команду `python main.py`.
   - Скрипт стартует MCP-сервер (`fastmcp run server.py:app --transport http --host 127.0.0.1 --port 8000`) и поднимет ngrok-туннель.
3. **Ожидаемые сообщения**
   - В консоли появится блок вида:
     ```
     ✅ Всё поднято!
     • Локально:   http://127.0.0.1:8000/mcp
     • Публично:   https://....ngrok-free.app/mcp
     ```
     Эти строки выводятся после получения публичного URL от ngrok.
4. **Подключение коннектора**
   - Скопируйте опубликованный адрес `/mcp` и укажите его при настройке MCP-коннектора в ChatGPT.
   - Оставьте окно запущенного скрипта открытым; завершение `Ctrl+C` корректно остановит MCP и ngrok.

## Локальный smoke-тест
Запустите `python test_client.py`, чтобы проверить базовое взаимодействие с MCP-сервером без туннеля.
